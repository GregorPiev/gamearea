"use strict";angular.module("gameAppl",["ngRoute","ui.router","ngSanitize","ngFileUpload"]),angular.module("gameAppl").config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),console.log("%cConfig start","color:orange"),$stateProvider.state("Home",{url:"/",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrHome",templateUrl:"appl/Home/home.html"}}}).state("Terms",{url:"/terms",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlTerms",templateUrl:"appl/Terms/terms.html"}}}).state("ContactUs",{url:"/contactus",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlContact",templateUrl:"appl/Contact/contact.html"}}}).state("Registration",{url:"/registration",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlRegistration",templateUrl:"appl/Registration/registration.html"}}}).state("Account",{url:"/account",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlAccount",templateUrl:"appl/Account/account.html"}}}).state("Recommendations",{url:"/recommendations",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlRecomendatins",templateUrl:"appl/Recomendations/recomendations.html"}}}).state("Demo",{url:"/demo",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlDemo",templateUrl:"appl/Demo/demo.html"}}}).state("Real",{url:"/real",views:{stripwinners:{controller:"ctrlStripwinners",templateUrl:"appl/Stripwinners/stripwinners.html"},topmenu:{controller:"ctrlTopmenu",templateUrl:"appl/Topemenu/topmenu.html"},content:{controller:"ctrlReal",templateUrl:"appl/Real/real.html"}}})}),angular.module("gameAppl").run(),angular.element(document).ready(function(){console.log("%cDocument ready","color:brown");var $window=angular.injector(["ng"]).get("$window"),counter=$window.localStorage.getItem("counter");$window.localStorage.setItem("counter",++counter)}),angular.module("gameAppl").controller("ctrlAccount",function($scope,$rootScope,DataServiceSQL,$window){$rootScope.$emit("changeMenu","account");var userObj=JSON.parse($window.localStorage.getItem("logined"));$scope.name=userObj.fname,$scope.email=userObj.email,$scope.phone=userObj.phone,$scope.address=userObj.address,$scope.city=userObj.city;var id_user=userObj.id_user;DataServiceSQL.read(8,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}}),DataServiceSQL.getUserGames(id_user,function(data){if(200==data.status){var result=data.data.data;console.log("%c Games:"+JSON.stringify(result),"color: green;"),$("#userGames").dataTable({sDom:'T<"clear">lfrtip',oTableTools:{sSwfPath:"lib/tabletools/swf/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"pdf",sButtonText:"Save as PDF"},{sExtends:"xls",sButtonText:"Save for Excel"}]},bDestroy:!0,bLengthChange:!0,bAutoWidth:!1,aaData:result,aaSorting:[[1,"desc"]],aoColumns:[{mData:"id_game",sTitle:"Game Id"},{mData:"name",sTitle:"Game name",sClass:"columnX center"},{mData:"shorts",sTitle:"Short Description",sClass:"columnX center"},{mData:"result",sTitle:"Result",sClass:"columnX center"},{mData:"type",sTitle:"Game Type",sClass:"columnX center"},{mData:"img",sTitle:"Image",sClass:"columnX center",mRender:function(data,type,row){return"<img src='upload/"+row.img+"' alt='' title=''>"}}]})}})}),angular.module("gameAppl").controller("ctrlContact",function($scope,$rootScope,DataServiceSQL){$rootScope.$emit("changeMenu","contact"),DataServiceSQL.read(2,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}})}),angular.module("gameAppl").service("DataService",function($http){this.read=function(url,callback){$http({method:"POST",url:"../gamearea/data/"+url+".json",headers:{"Content-type":"application/json"}}).then(function(response){callback(response)},function(err){console.error(err)})}}),angular.module("gameAppl").service("frService",function($http){this.read=function(url,callback){$http({method:"GET",url:"https://gamearea-e98ec.firebaseio.com/"+url+".json",headers:{"Content-type":"application/json"}}).then(function(response){callback(response)},function(err){console.error(err)})},this.addUser=function(data,callback){$http({method:"POST",url:"https://gamearea-e98ec.firebaseio.com/users.json",data:JSON.stringify(data),headers:{"Content-type":"application/json","Access-Control-Allow-Origin":"*"}}).then(function(res){console.log("%cSuccess","color:blue"),console.log(res),callback(res)},function(err){console.log("%cError","color:#900"),console.error(err),callback(err)})},this.login=function(user,pass,callback){$http({Method:"GET",url:'https://gamearea-e98ec.firebaseio.com/users.json?orderBy="username"&equelTo="'+user+'"',headers:{"Content-type":"application/json"}}).then(function(res){console.log("%cSuccess","color:blue"),console.log(res),callback(res)},function(error){console.log("%cError","color:#900"),console.error(error),callback(error)})}}),angular.module("gameAppl").service("DataServiceSQL",function($http){this.read=function(idpage,callback){var postdata={op:"page",data:{idpage:idpage,table:"tbcontent"}};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"GET, POST, OPTIONS, DELETE, PUT","Access-Control-Allow-Origin":"*"}}).then(function(response){callback(response)},function(err){callback(resp)})},this.readGamesList=function(home,type,callback){var postdata={op:"game",data:{type:type,home:home}};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"POST, GET, OPTION, PUT, DELETE","Access-Control-Allow-Origin":"*"}}).then(function(resp){callback(resp)},function(error){callback(error)})},this.readWinners=function(callback){var postdata={op:"winners"};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"GET, POST, OPTION, PUT, DELTE","Access-Control-Allow-Origin":"*"}}).then(function(resp){callback(resp)},function(error){callback(error)})},this.readNews=function(callback){var postdata={op:"news"};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"POST,GET,OPTION,PUT,DELETE","Access-Control-Allow-Origin":"*"}}).then(function(resp){callback(resp)},function(error){callback(error)})},this.readRecomendations=function(callback){var postdata={op:"recomendations"};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"POST,GET,OPTION,PUT,DELETE","Access-Control-Allow-Origin":"*"}}).then(function(resp){callback(resp)},function(error){callback(error)})},this.addNewUser=function(data,callback){var postdata={op:"addUser",data:data};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"PUT,POST,GET,OPTION,DELETE","Access-Control-Allow-Original":"*"}}).then(function(resp){console.log("%cSuccess addUser:"+JSON.stringify(resp),"color:blue"),callback(resp)},function(error){console.log("%cError addUser:"+JSON.stringify(resp),"color:#f00"),callback(error)})},this.login=function(data,callback){var postdata={op:"login",data:data};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"PUT,POST,GET,OPTION,DELETE","Access-Control-Allow-Original":"*"}}).then(function(resp){callback(resp)},function(error){callback(error)})},this.getUserData=function(userId,callback){var postdata={op:"getUser",userId:userId};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.strigify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"POST,GET,PUT,DELETE,OPTION","Access-Control-Allow-Original":"*"}}).then(function(res){callback(res)},function(err){callback(err)})},this.getUserGames=function(id_user,callback){var postdata={op:"userAccount",data:{userId:id_user}};$http({method:"POST",url:"../gamearea/php/api.php",data:JSON.stringify(postdata),headers:{"Content-type":"application/json","Access-Control-Allow-Methods":"POST,GET,PUT,DELETE,OPTION","Access-Control-Allow-Original":"*"}}).then(function(res){callback(res)},function(err){callback(err)})}}),angular.module("gameAppl").controller("ctrlDemo",function($scope,$rootScope,DataServiceSQL){$rootScope.$emit("changeMenu","demo"),DataServiceSQL.read(3,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}}),DataServiceSQL.readGamesList(0,"free",function(data){if(200==data.status){var result=data.data.data;$scope.games=result}})}),angular.module("gameAppl").controller("ctrHome",["$scope","$rootScope","DataServiceSQL",function($scope,$rootScope,DataServiceSQL){DataServiceSQL.read(1,function(data){if(200==data.status){var result=data.data.data;$scope.homecontent=result.content}}),DataServiceSQL.readGamesList(1,"free",function(data){if(200==data.status){var result=data.data.data;$scope.popgames=result}}),DataServiceSQL.readWinners(function(data){200==data.status&&($scope.winners=data.data.data)}),$rootScope.$emit("changeMenu","home")}]),angular.module("gameAppl").controller("ctrlRecomendatins",function($scope,$rootScope,DataServiceSQL,$window){$rootScope.$emit("changeMenu","recomendations"),DataServiceSQL.read(6,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}}),DataServiceSQL.readRecomendations(function(data){if(200==data.status){var result=data.data.data;$window.localStorage.setItem("notes",JSON.stringify(result))}})}),angular.module("gameAppl").controller("ctrlReal",function($scope,$rootScope,DataServiceSQL){$rootScope.$emit("changeMenu","real"),DataServiceSQL.read(7,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}}),DataServiceSQL.readGamesList(0,"real",function(data){if(200==data.status){var result=data.data.data;$scope.games=result}})}),angular.module("gameAppl").controller("ctrlRegistration",function($scope,DataServiceSQL){DataServiceSQL.read(4,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}})}),angular.module("gameAppl").controller("ctrlStripwinners",function($scope,DataServiceSQL){DataServiceSQL.readNews(function(data){200==data.status&&($scope.news=data.data.data)})}),angular.module("gameAppl").controller("ctrlTerms",function($scope,$rootScope,DataServiceSQL){$rootScope.$emit("changeMenu","terms"),DataServiceSQL.read(5,function(data){if(200==data.status){var result=data.data.data;$scope.page=result.page,$scope.title=result.title,$scope.content=result.content}})}),angular.module("gameAppl").controller("ctrlTopmenu",function($scope,$window,$rootScope){var user_login=null;$rootScope.$on("login",function(event,data){console.log("%cLogin","color:green"),user_login=JSON.parse($window.localStorage.getItem("logined")),angular.element("#anonim").hide(),$("#logined").show(),$("#user_values").html(data.fname)}),$(document).ready(function(){console.log("%cctrTopmenu Document ready","color:blue;"),"undefined"===$window.localStorage.getItem("logined")||null===$window.localStorage.getItem("logined")?(angular.element("#anonim").show(),angular.element("#logined").hide(),$("#user_values").html(""),$rootScope.$emit("powerLogin","Default User")):(angular.element("#anonim").hide(),$("#logined").show(),user_login=JSON.parse($window.localStorage.getItem("logined")),$("#user_values").html(user_login.fname))}),$scope.logout=function(){angular.element("#anonim").show(),angular.element("#logined").hide(),$("#user_values").html(""),$window.localStorage.removeItem("logined"),user_login=null},$scope.getStatusUser=function(){return null!==user_login}}),angular.module("gameAppl").controller("ctrlSign",["$scope","$rootScope","DataServiceSQL","$window",function($scope,$rootScope,DataServiceSQL,$window){$scope.resMsg="",$scope.sendVal=function(){var client={fname:"",address:"",city:"",email:"",username:"",password:"",phone:""},user={fname:"",address:"",city:"",email:"",username:"",phone:""};client.fname=$scope.client.fname,client.city=$scope.client.city,client.email=$scope.client.email,client.address=$scope.client.address,client.username=$scope.client.username,client.password=$scope.client.password,client.phone=$scope.client.phone,user.fname=$scope.client.fname,user.city=$scope.client.city,user.email=$scope.client.email,user.address=$scope.client.address,user.username=$scope.client.username,user.phone=$scope.client.phone,console.log(JSON.stringify(client)),DataServiceSQL.addNewUser(client,function(result){console.log("%cArrived result:"+JSON.stringify(result),"color: green;"),"OK"===result.statusText?-999===result.data.code||null===result.data.code?$scope.resMsg="Error:"+result.data.msg:($scope.resMsg="Success",$window.localStorage.setItem("logined",JSON.stringify(user)),angular.element("#btnSign").trigger("click"),$rootScope.$emit("login",client)):$scope.resMsg="Error:"+result})},$scope.resultMsg=function(){return""!==$scope.resMsg}}]),angular.module("gameAppl").controller("ctrlLogin",["$scope","$rootScope","$location","DataServiceSQL","$window",function($scope,$rootScope,$location,DataServiceSQL,$window){$scope.resultMesagge="",console.log("%cctrlogin ","color:blue;"),$scope.sendVal=function(){var loginvalues={username:void 0===$scope.username?"gregp":$scope.username,password:void 0===$scope.password?"Gp123456":$scope.password};console.log("%cSend values to login:"+JSON.stringify(loginvalues),"color:lightgreen;"),DataServiceSQL.login(loginvalues,function(result){console.log("%cSend values result:"+JSON.stringify(result),"color:darkgreen;"),"OK"===result.statusText?-999===result.data.code||null===result.data.code?$scope.resultMesagge="Error:"+result.data.msg:($scope.resultMesagge="Login successed",$window.localStorage.setItem("logined",JSON.stringify(result.data.code)),$rootScope.$emit("login",result.data.code)):$scope.resultMesagge="Error:"+result.statusText})},$scope.resultMsgLogin=function(){return""!==$scope.resultMesagge},$rootScope.$on("powerLogin",function(event,data){console.log("%cpowerLogin On:"+data,"color:green;"),$scope.sendVal()})}]);